#!/usr/bin/python# -*- coding: utf-8 -*-import reimport csvfrom googleapiclient.discovery import buildclass Hasher(dict):		# http://stackoverflow.com/a/3405143/190597		def __missing__(self, key):				value = self[key] = type(self)()				return valueik =[]flag = 0flag_2 = 0count = 0keycount = 0key = 0with open('Book1.csv', 'rb') as csvinput:	with open ('output2.csv', 'wb') as csvoutput: 		reader = csv.DictReader(csvinput)		fieldnames = ['Entity','url','Director','Year','Alias','IMDB URL','genre','Runtime']		writer = csv.DictWriter(csvoutput, fieldnames=fieldnames)		writer.writeheader()		for row in reader:			# print (row['Entity'], row['Url'], row['Director'], row['Alias'], row['Year'])						t = row['Entity']			d = row['Director']			print t, d			year = row['Year']			alias = row['Alias']			url = row['Url']			genre = row['genre']			runtime = row['Runtime']			query = t+' '+d			# print 'Tite:',title			# print 'Director:',director			# print 'Year:',year			# print 'Alias:',alias			# print 'URL:',url			# print 'Genre:',genre			# print 'Runtime:',runtime			# print 'Query :: ',query			# query = 'Showboy'			service = build("customsearch", "v1", developerKey='AIzaSyB7BqsM_vljNSPOq4twbB7N3sUutyjoobE')			res = service.cse().list(q=query,cx='009241977094486741223:3agszpaq5sy',).execute()			response = res.get('items')			# pprint.pprint(res)			response = res.get('items')			if response:				flag = 0				for i in range(0,len(response)):					print "===================================="					json_title = res['items'][i]['pagemap']['metatags'][0]['title']					json_title = re.sub(r'<.*?>','',json_title)					# print 'fetched title:',json_title					json_director = res['items'][i]['snippet']					json_director = re.sub(r'...','',json_director)					json_director = re.search(d,json_director)				 					if re.sub(r'\s+\(.*','',json_title).strip() == t:						print "##"						if json_director is None:							print "###"							try:								print 'isnside try'								json_director = res['items'][i]['pagemap']['metatags'][0]['og:description']								json_director = re.search(d,json_director)								if json_director:									print '####' 									if json_director.group(0) == d:										print '#####'										imdb_key = res['items'][i]['link']										print imdb_key										writer.writerow({'Entity':t,'Director':row['Director'],'Year':year,'Alias':alias,'url':url,'genre':genre,'Runtime':runtime,'IMDB URL':imdb_key})										break									else:										print "######"																except:								print "director not found"													else:						print 'no key found'						flag = 1				if flag == 1:					print "FUCK == FUCK == FUCK"					print flag						writer.writerow({'Entity':t,'Director':row['Director'],'Year':year,'Alias':alias,'url':url,'genre':genre,'Runtime':runtime,'IMDB URL':''})			elif response is None:				print 'No Response'				writer.writerow({'Entity':t,'Director':row['Director'],'Year':year,'Alias':alias,'url':url,'genre':genre,'Runtime':runtime,'IMDB URL':''})